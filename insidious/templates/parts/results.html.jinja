<div class=page>
    {% macro group_end() -%}
            <script>
                mergeShortGroups(document.currentScript.parentNode)
            </script>
        </div>
    {% endmacro -%}

    {% set group = namespace(inside=false) %}
    {% for entry in pagination.items %}
        {% if entry.entry_type == "ShortEntry" and not group.inside %}
            {% set group.inside = true %}
            <div class=short-group>
        {% elif entry.entry_type != "ShortEntry" and group.inside %}
            {% set group.inside = false %}
            {{group_end()}}
        {% endif %}

        {% include "parts/entry.html.jinja" %}

        {% if group.inside and loop.index == pagination.items|length %}
            {% set group.inside = false %}
            {{group_end()}}
        {% endif %}
    {% endfor %}

    <script>processAllText()</script>

    {% if pagination.next_url %}
        <div
            class="lazy-loader {{'large' if pagination.running_short else ''}}"
            hx-get="{{pagination.next_url}}"
            hx-trigger="{{'load' if pagination.finding else 'intersect once'}}"
            hx-select=".page > *"
            hx-swap="outerHTML ignoreTitle:true"
        ></div>
    {% endif %}
</div>

{% if pagination and pagination.page < 2 and not pagination.next_url %}
    <p class=nothing-found>Nothing found</p>
{% endif %}
